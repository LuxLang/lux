##  Copyright (c) Eduardo Julian. All rights reserved.
##  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
##  If a copy of the MPL was not distributed with this file,
##  You can obtain one at http://mozilla.org/MPL/2.0/.

(;module:
  lux
  (lux [io]
       (control monad)
       (codata ["&" thunk])
       pipe
       ["R" random])
  lux/test)

(test: "Thunks"
  [left R;nat
   right R;nat
   #let [thunk (&;freeze (n.* left right))
         expected (n.* left right)]]
  ($_ seq
      (assert "Thunking does not alter the expected value."
              (n.= expected
                   (&;thaw thunk)))
      (assert "Thunks only evaluate once."
              (and (not (is expected
                            (&;thaw thunk)))
                   (is (&;thaw thunk)
                       (&;thaw thunk))))
      ))
