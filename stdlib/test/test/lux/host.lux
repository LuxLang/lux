(;module:
  lux
  (lux (control monad)
       (data text/format
             [number]
             [product])
       (codata function
               [io])
       host)
  lux/test)

(jvm-import java.lang.Object
  (new []))

(jvm-import java.lang.String)

(jvm-import (java.lang.Class a)
  (getName [] String))

(test: "lux/host exports"
  (let% [<conversions-0> (do-template [<value> <forward> <backward>]
                           [(match <value> (|> <value> <forward> <backward>))]

                           [123   l2d d2l]
                           [123   l2f f2l]
                           [123   l2i i2l]
                           [123.0 d2l l2d]
                           [123.0 d2f f2d]
                           [123.0 d2i i2d]
                           )
         <conversions-1> (do-template [<forward> <backward>]
                           [(match 123 (|> 123 l2i <forward> <backward> i2l))]

                           [i2c c2i]
                           )]
    (test-all (match "java.lang.Class" (Class.getName [] (class-for java.lang.Class)))
              (match "java.lang.Class" (Class.getName [] (class-for Class)))
              (match true (null? (: Object (null))))
              (match false (null? (Object.new [])))
              (match #;None (: (Maybe Object) (??? (null))))
              (match (#;Some _) (: (Maybe Object) (??? (Object.new []))))
              (match true (null? (!!! (: (Maybe Object) (??? (null))))))
              (match false (null? (!!! (: (Maybe Object) (??? (Object.new []))))))
              (match true (instance? Object (Object.new [])))
              (match false (instance? String (Object.new [])))
              (match 123 (synchronized (Object.new [])
                           123))
              (match +10 (array-length (array String +10)))
              (match "YOLO" (let [array (array String +10)] 
                              (exec (array-store +0 "YOLO" array)
                                (array-load +0 array))))
              <conversions-0>
              <conversions-1>
              )))
