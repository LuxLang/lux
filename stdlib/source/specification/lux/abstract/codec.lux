(.require
 [library
  [lux (.except)
   [abstract
    [monad (.only do)]]
   [control
    ["[0]" try]]
   [math
    ["[0]" random (.only Random)]]
   [test
    ["_" property (.only Test)]]]]
 [\\library
  ["[0]" / (.only)
   [//
    [equivalence (.only Equivalence)]]]])

(def .public (spec (open "/#[0]") (open "/#[0]") generator)
  (All (_ m a) (-> (Equivalence a) (/.Codec m a) (Random a) Test))
  (do random.monad
    [expected generator]
    (_.for [/.Codec]
           (_.coverage [/.encoded /.decoded]
             (when (|> expected /#encoded /#decoded)
               {try.#Success actual}
               (/#= expected actual)
               
               {try.#Failure _}
               false)))))
