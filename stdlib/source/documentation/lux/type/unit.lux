(.module:
  [library
   [lux (#- and)
    ["$" documentation (#+ documentation:)]
    [control
     ["<>" parser
      ["<.>" code]]]
    [data
     ["." text (#+ \n)
      ["%" format (#+ format)]]]
    [macro
     ["." template]]
    [math
     [number
      ["." ratio]]]]]
  [\\library
   ["." /]])

(documentation: /.Qty
  "A quantity with an associated unit of measurement.")

(template [<name>]
  [(documentation: <name>
     ""
     [(<name> param subject)])]

  [/.+]
  [/.-]
  [/.*]
  [/./]
  )

(documentation: /.Unit
  "A unit of measurement, to qualify numbers with.")

(documentation: /.Scale
  "A scale of magnitude.")

(documentation: /.Pure
  "A pure, unit-less quantity.")

(documentation: /.unit:
  (format "Define a unit of measurement."
          \n "Both the name of the type, and the name of the Unit implementation must be specified.")
  [(unit: .public Feet feet)])

(documentation: /.scale:
  "Define a scale of magnitude."
  [(scale: .public Bajillion bajillion
     [1 1,234,567,890])])

(documentation: /.re_scaled
  ""
  [(re_scaled from to quantity)])

(template [<type> <scale>]
  [(`` (documentation: <scale>
         (let [numerator (value@ [#/.ratio #ratio.numerator] <scale>)
               denominator (value@ [#/.ratio #ratio.denominator] <scale>)]
           (format "'" (~~ (template.text [<type>])) "' scale from " (%.nat numerator) " to " (%.nat denominator) "."))))]

  [/.Kilo /.kilo]
  [/.Mega /.mega]
  [/.Giga /.giga]

  [/.Milli /.milli]
  [/.Micro /.micro]
  [/.Nano /.nano]
  )

(template [<type>]
  [(`` (documentation: <type>
         (format "'" (~~ (template.text [<type>])) "' unit of meaurement.")))]

  [/.Gram]
  [/.Meter]
  [/.Litre]
  [/.Second]
  )

(.def: .public documentation
  (.List $.Module)
  ($.module /._
            ""
            [..Qty
             ..+
             ..-
             ..*
             ../
             ..Unit
             ..Scale
             ..Pure
             ..unit:
             ..scale:
             ..re_scaled
             ..kilo
             ..mega
             ..giga
             ..milli
             ..micro
             ..nano
             ..Gram
             ..Meter
             ..Litre
             ..Second
             ($.default /.pure)
             ($.default /.number)
             ($.default /.equivalence)
             ($.default /.order)
             ($.default /.enum)
             ($.default /.Kilo)
             ($.default /.Mega)
             ($.default /.Giga)
             ($.default /.Milli)
             ($.default /.Micro)
             ($.default /.Nano)]
            []))
