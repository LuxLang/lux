(.module:
  [lux #*
   ["_" test (#+ Test)]
   [abstract
    [monad (#+ do)]]
   [data
    ["." text]]
   [math
    ["." random]]]
  ["." / #_
   ["#." artifact]
   ["#." snapshot]
   [//
    ["@." artifact]]]
  {#program
   ["." /]})

(def: #export test
  Test
  (<| (_.covering /._)
      ($_ _.and
          (<| (_.for [/.file])
              (do random.monad
                [sample @artifact.random]
                ($_ _.and
                    (_.cover [/.for-project]
                             (text.ends-with? /.file (/.for-project sample)))
                    (_.cover [/.for-version]
                             (text.ends-with? /.file (/.for-version sample)))
                    )))

          /artifact.test
          /snapshot.test
          )))
