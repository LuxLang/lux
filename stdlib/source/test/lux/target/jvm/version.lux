... This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
... If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.

(.using
 [library
  [lux (.except)
   [abstract
    [monad (.only do)]]
   [data
    ["[0]" binary (.only)
     ["![1]" \\injection]]
    [collection
     ["[0]" stack (.use "[1]#[0]" functor)]
     ["[0]" set]]]
   [math
    ["[0]" random (.only Random)]
    [number
     ["n" natural]]]
   [test
    ["_" property (.only Test)]]]]
 [\\library
  ["[0]" / (.only)
   [//
    [encoding
     ["[0]" unsigned]]]]])

(the .public test
  Test
  (<| (_.covering /._)
      (do [! random.monad]
        [])
      (_.for [/.Version])
      (all _.and
           (<| (_.for [/.Minor])
               (all _.and
                    (_.coverage [/.default_minor]
                      (when (unsigned.value /.default_minor)
                        0 true
                        _ false))
                    ))
           (<| (_.for [/.Major])
               (let [majors (stack /.v1_1 /.v1_2 /.v1_3 /.v1_4
                                   /.v5_0 /.v6_0
                                   /.v7 /.v8 /.v9 /.v10 /.v11 /.v12)])
               (all _.and
                    (_.coverage [/.v1_1 /.v1_2 /.v1_3 /.v1_4
                                 /.v5_0 /.v6_0
                                 /.v7 /.v8 /.v9 /.v10 /.v11 /.v12]
                      (let [uniques (set.of_stack unsigned.hash majors)]
                        (n.= (stack.size majors)
                             (set.size uniques))))
                    (_.coverage [/.as_binary]
                      (let [uniques (|> majors
                                        (stack#each (|>> /.as_binary
                                                         !binary.instance))
                                        (set.of_stack binary.hash))]
                        (n.= (stack.size majors)
                             (set.size uniques))))
                    ))
           )))
