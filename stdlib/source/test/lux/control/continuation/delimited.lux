... This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
... If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.

(.require
 [library
  [lux (.except)
   [abstract
    [monad (.only do)]]
   [data
    [collection
     ["[0]" list]]]
   [math
    ["[0]" random]
    [number
     ["n" nat]]]
   [test
    ["_" property (.only Test)]]]]
 [\\library
  ["[0]" / (.only)
   ["/[1]" //]]])

(the .public test
  Test
  (<| (_.covering /._)
      (do [! random.monad]
        [elems (random.list 3 random.nat)])
      (all _.and
           (_.coverage [/.reset /.context
                        /.shift /.exit]
             (and (let [(open "//#[0]") //.monad
                        (open "list#[0]") (list.equivalence n.equivalence)
                        visit (is (-> (List Nat)
                                      (//.Cont (List Nat) (List Nat)))
                                  (function (visit xs)
                                    (when xs
                                      {.#End}
                                      (//#in {.#End})

                                      {.#Item x xs'}
                                      (do [! //.monad]
                                        [output (/.shift (function (_ after)
                                                           (in {.#Item x (after xs')})))]
                                        (visit output)))))]
                    (//.continued (list#= elems)
                                  (/.reset (visit elems))))
                  (same? /.reset /.context)
                  (same? /.shift /.exit)))
           )))
