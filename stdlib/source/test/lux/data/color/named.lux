(.module:
  [lux #*
   ["_" test (#+ Test)]
   [abstract
    [monad (#+ do)]]
   [data
    [number
     ["n" nat]]
    [collection
     ["." list]
     ["." set]]]
   [macro
    ["." template]]
   [math
    ["." random (#+ Random)]]]
  {1
   ["." /
    ["/#" //]]})

(with-expansions [<colors> (as-is [letter/a
                                   [/.alice-blue
                                    /.antique-white
                                    ## /.aqua
                                    /.aquamarine
                                    /.azure]]
                                  
                                  [letter/b
                                   [/.beige
                                    /.bisque
                                    /.black
                                    /.blanched-almond
                                    /.blue
                                    /.blue-violet
                                    /.brown
                                    /.burly-wood]]
                                  
                                  [letter/c
                                   [/.cadet-blue
                                    /.chartreuse
                                    /.chocolate
                                    /.coral
                                    /.cornflower-blue
                                    /.cornsilk
                                    /.crimson
                                    /.cyan]]
                                  
                                  [letter/d
                                   [/.dark-blue
                                    /.dark-cyan
                                    /.dark-goldenrod
                                    /.dark-gray
                                    /.dark-green
                                    /.dark-khaki
                                    /.dark-magenta
                                    /.dark-olive-green
                                    /.dark-orange
                                    /.dark-orchid
                                    /.dark-red
                                    /.dark-salmon
                                    /.dark-sea-green
                                    /.dark-slate-blue
                                    /.dark-slate-gray
                                    /.dark-turquoise
                                    /.dark-violet
                                    /.deep-pink
                                    /.deep-sky-blue
                                    /.dim-gray
                                    /.dodger-blue]]
                                  
                                  [letter/f
                                   [/.fire-brick
                                    /.floral-white
                                    /.forest-green
                                    ## /.fuchsia
                                    ]]
                                  
                                  [letter/g
                                   [/.gainsboro
                                    /.ghost-white
                                    /.gold
                                    /.goldenrod
                                    /.gray
                                    /.green
                                    /.green-yellow]]
                                  
                                  [letter/h
                                   [/.honey-dew
                                    /.hot-pink]]
                                  
                                  [letter/i
                                   [/.indian-red
                                    /.indigo
                                    /.ivory]]
                                  
                                  [letter/k
                                   [/.khaki]]
                                  
                                  [letter/l
                                   [/.lavender
                                    /.lavender-blush
                                    /.lawn-green
                                    /.lemon-chiffon
                                    /.light-blue
                                    /.light-coral
                                    /.light-cyan
                                    /.light-goldenrod-yellow
                                    /.light-gray
                                    /.light-green
                                    /.light-pink
                                    /.light-salmon
                                    /.light-sea-green
                                    /.light-sky-blue
                                    /.light-slate-gray
                                    /.light-steel-blue
                                    /.light-yellow
                                    /.lime
                                    /.lime-green
                                    /.linen]]
                                  
                                  [letter/m
                                   [/.magenta
                                    /.maroon
                                    /.medium-aquamarine
                                    /.medium-blue
                                    /.medium-orchid
                                    /.medium-purple
                                    /.medium-sea-green
                                    /.medium-slate-blue
                                    /.medium-spring-green
                                    /.medium-turquoise
                                    /.medium-violet-red
                                    /.midnight-blue
                                    /.mint-cream
                                    /.misty-rose
                                    /.moccasin]]
                                  
                                  [letter/n
                                   [/.navajo-white
                                    /.navy]]
                                  
                                  [letter/o
                                   [/.old-lace
                                    /.olive
                                    /.olive-drab
                                    /.orange
                                    /.orange-red
                                    /.orchid]]
                                  
                                  [letter/p
                                   [/.pale-goldenrod
                                    /.pale-green
                                    /.pale-turquoise
                                    /.pale-violet-red
                                    /.papaya-whip
                                    /.peach-puff
                                    /.peru
                                    /.pink
                                    /.plum
                                    /.powder-blue
                                    /.purple]]
                                  
                                  [letter/r
                                   [/.rebecca-purple
                                    /.red
                                    /.rosy-brown
                                    /.royal-blue]]
                                  
                                  [letter/s
                                   [/.saddle-brown
                                    /.salmon
                                    /.sandy-brown
                                    /.sea-green
                                    /.sea-shell
                                    /.sienna
                                    /.silver
                                    /.sky-blue
                                    /.slate-blue
                                    /.slate-gray
                                    /.snow
                                    /.spring-green
                                    /.steel-blue]]
                                  
                                  [letter/t
                                   [/.tan
                                    /.teal
                                    /.thistle
                                    /.tomato
                                    /.turquoise]]
                                  
                                  [letter/v
                                   [/.violet]]
                                  
                                  [letter/w
                                   [/.wheat
                                    /.white
                                    /.white-smoke]]
                                  
                                  [letter/y
                                   [/.yellow
                                    /.yellow-green]]
                                  )
                  <named> (template [<definition> <by-letter>]
                            [((: (-> Any (List //.Color))
                                 (function (_ _)
                                   (`` (list (~~ (template.splice <by-letter>))))))
                              123)]
                            
                            <colors>)]
  (def: all-colors
    (list.concat (list <named>)))
  
  (def: unique-colors
    (set.from-list //.hash ..all-colors))

  (def: verdict
    (n.= (list.size ..all-colors)
         (set.size ..unique-colors)))

  (template [<definition> <by-letter>]
    [(def: <definition>
       Test
       (`` (_.cover <by-letter>
                    ..verdict)))]
    
    <colors>)

  (def: #export test
    Test
    (<| (_.covering /._)
        (`` ($_ _.and
                (~~ (template [<definition> <by-letter>]
                      [<definition>]
                      
                      <colors>))
                (_.cover [/.aqua]
                         (\ //.equivalence = /.cyan /.aqua))
                (_.cover [/.fuchsia]
                         (\ //.equivalence = /.magenta /.fuchsia))
                ))))
  )
