(.module:
  [lux #*
   ["_" test (#+ Test)]
   [control
    comonad
    [monad (#+ do)]
    {[0 #test]
     [/
      [".T" functor (#+ Injection Comparison)]
      [".T" apply]
      [".T" monad]
      [".T" equivalence]]}]
   [data
    ["." text ("#@." monoid equivalence)
     format]]]
  {1
   ["." / (#+ Identity)]})

(def: injection
  (Injection Identity)
  (|>>))

(def: comparison
  (Comparison Identity)
  (function (_ ==)
    ==))

(def: #export test
  Test
  (<| (_.context (%name (name-of /.Identity)))
      ($_ _.and
          (functorT.laws ..injection ..comparison /.functor)
          (applyT.laws ..injection ..comparison /.apply)
          (monadT.laws ..injection ..comparison /.monad)
          (let [(^open "/@.") /.comonad]
            (_.test "CoMonad does not affect values."
                    (and (text@= "yololol" (/@unwrap "yololol"))
                         (text@= "yololol" (be /.comonad
                                             [f text@compose
                                              a "yolo"
                                              b "lol"]
                                             (f a b))))))
          )))
