(.module:
  [lux #*
   ["_" test (#+ Test)]
   [abstract
    [monad (#+ do)]]
   [math
    ["." random ("#@." monad)]]]
  ["." / #_
   ["#." binary]
   ["#." bit]
   ["#." identity]
   ["#." lazy]
   ["#." maybe]
   ["#." name]
   ["#." number]
   ["#." product]
   ["#." sum]
   ["#." color
    ["#/." named]]
   ["#." format #_
    ["#/." binary]
    ["#/." json]
    ["#/." tar]
    ["#/." xml]]
   [number
    ["#." i8]
    ["#." i16]
    ["#." i32]
    ["#." i64]
    ["#." nat]
    ["#." int]
    ["#." rev]
    ["#." frac]
    ["#." ratio]
    ["#." complex]]
   ["#." text
    ["#/." regex]]
   ["#." collection]])

## TODO: Get rid of this ASAP
(template: (!bundle body)
  (: Test
     (do random.monad
       [_ (wrap [])]
       body)))

(def: text
  ($_ _.and
      /text.test
      /text/regex.test
      ))

(def: format
  ($_ _.and
      /format/binary.test
      /format/json.test
      /format/tar.test
      /format/xml.test
      ))

(def: #export test
  Test
  ## TODO: Inline ASAP
  (let [test0 ($_ _.and
                  /binary.test
                  /bit.test
                  /color.test
                  /color/named.test
                  /identity.test)
        test1 ($_ _.and
                  /lazy.test
                  /maybe.test
                  /name.test
                  /number.test
                  /product.test)
        test2 ($_ _.and
                  /sum.test
                  ..text
                  ..format
                  /collection.test
                  )]
    ($_ _.and
        (!bundle test0)
        (!bundle test1)
        (!bundle test2)
        )))
