... This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
... If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.

(.require
 [library
  [lux (.except)
   [abstract
    [monad (.only do)]]
   [data
    ["[0]" text]
    [collection
     ["[0]" list]
     ["[0]" set]]]
   [math
    ["[0]" random (.only Random)]
    [number
     ["n" nat]]]
   [meta
    [macro
     ["[0]" template]]]
   [test
    ["_" property (.only Test)]]]]
 [\\library
  ["[0]" /]])

(with_expansions [,bundles (these [[[/.toolbar]
                                    [/.tooltip]
                                    [/.feed]
                                    [/.math]
                                    [/.presentation]
                                    [/.note]

                                    [/.application]
                                    [/.article]
                                    [/.cell]
                                    [/.column_header]
                                    [/.definition]
                                    [/.directory]
                                    [/.document]
                                    [/.figure]
                                    [/.group]
                                    [/.heading]
                                    [/.image]
                                    [/.list]
                                    [/.list_item]
                                    [/.meter]
                                    [/.row]
                                    [/.row_group]
                                    [/.row_header]
                                    [/.table]
                                    [/.term]]]

                                  [[[/.association_list]
                                    [/.association_list_item_key]
                                    [/.association_list_item_value]
                                    [/.block_quote]
                                    [/.caption]
                                    [/.code]
                                    [/.deletion]
                                    [/.emphasis]
                                    [/.insertion]
                                    [/.paragraph]
                                    [/.strong]
                                    [/.sub_script]
                                    [/.super_script]
                                    [/.time]

                                    ... https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles#2._widget_roles
                                    [/.scroll_bar]
                                    [/.search_box]
                                    [/.separator]
                                    [/.slider]
                                    [/.spin_button]
                                    [/.switch]
                                    [/.tab]
                                    [/.tab_panel]
                                    [/.tree_item]]]

                                  [[[/.combo_box]
                                    [/.menu]
                                    [/.menu_bar]
                                    [/.tab_list]
                                    [/.tree]
                                    [/.tree_grid]

                                    [/.button]
                                    [/.check_box]
                                    [/.grid_cell]
                                    [/.link]
                                    [/.menu_item]
                                    [/.menu_item_check_box]
                                    [/.menu_item_radio]
                                    [/.option]
                                    [/.progress_bar]
                                    [/.radio]
                                    [/.text_box]]]

                                  [[... https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles#3._landmark_roles
                                    [/.banner]
                                    [/.complementary]
                                    [/.content_info]
                                    [/.form]
                                    [/.main]
                                    [/.navigation]
                                    [/.region]
                                    [/.search]

                                    ... https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles#4._live_region_roles
                                    [/.alert]
                                    [/.log]
                                    [/.marquee]
                                    [/.status]
                                    [/.timer]

                                    ... https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles#5._window_roles
                                    [/.alert_dialog]
                                    [/.dialog]]]

                                  [[... https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles#6._abstract_roles
                                    [/.command]
                                    [/.composite]
                                    [/.input]
                                    [/.landmark]
                                    [/.range]
                                    [/.role_type]
                                    [/.section]
                                    [/.section_head]
                                    [/.select]
                                    [/.structure]
                                    [/.widget]
                                    [/.window]]]
                                  )]
  (these (the all_options
           (List /.Role)
           (`` (`` (`` (list.together (list (,, (with_template [,options]
                                                  [(is (List /.Role)
                                                       (list (,, (with_expansions [,options' (template.spliced ,options)]
                                                                   (,, (with_template [,name]
                                                                         [,name]

                                                                         ,options'
                                                                         ))))))]
                                                  
                                                  ,bundles))))))))

         (the .public test
           Test
           (<| (_.covering /._)
               (do [! random.monad]
                 [])
               (_.for [/.Role])
               (`` (all _.and
                        (,, (with_template [,options]
                              [(`` (`` (_.coverage [(,, (with_expansions [,options' (template.spliced ,options)]
                                                          (,, (with_template [,name]
                                                                [,name]

                                                                ,options'
                                                                ))))]
                                         (let [uniques (|> ..all_options
                                                           (set.of_list text.hash))]
                                           (n.= (list.size ..all_options)
                                                (set.size uniques))))))]
                              
                              ,bundles))
                        ))))))
