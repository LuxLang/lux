##  Copyright (c) Eduardo Julian. All rights reserved.
##  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
##  If a copy of the MPL was not distributed with this file,
##  You can obtain one at http://mozilla.org/MPL/2.0/.

(;module:
  lux
  (lux (control monad)
       (data (struct [list "" Monad<List> Fold<List>]
                     [dict #+ Dict])
             [text])
       [compiler]
       (macro [ast]
              ["s" syntax #+ syntax: Syntax]
              (syntax [common]))))

## [Syntax]
(syntax: #export (template: [_ex-lev common;export-level] [[name args] common;decl] input-template)
  {#;doc (doc "Define macros in the style of do-template and ^template."
              "For simple macros that don't need any fancy features."
              (template: (square x)
                (i.* x x)))}
  (let [output-template (fold (lambda [arg' template']
                                (ast;replace arg'
                                             (` ((~' ~) (~ arg')))
                                             template'))
                              input-template
                              (map ast;local-symbol args))]
    (wrap (list (` (syntax: (~@ (common;gen-export-level _ex-lev)) ((~ (ast;symbol ["" name]))
                                                                    (~@ (map (|>. [""] ast;symbol) args)))
                     ((~' wrap) (list (` (~ output-template))))))))
    ))
