(.module:
  [lux #*
   [control
    [monad (#+ do)]
    ["ex" exception (#+ exception:)]]
   [data
    [text
     format]]]
  ["." // (#+ Phase)
   ["/." //
    ["." extension]]])

(do-template [<name>]
  [(exception: #export (<name> {code Code})
     (ex.report ["Statement" (%code code)]))]

  [unrecognized-statement]
  )

(def: #export (phase code)
  Phase
  (case code
    (^ [_ (#.Form (list& [_ (#.Text extension-name)] extension-args))])
    (extension.apply phase [extension-name extension-args])

    _
    (///.throw unrecognized-statement code)))
