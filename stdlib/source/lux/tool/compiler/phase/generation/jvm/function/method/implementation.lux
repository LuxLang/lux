(.module:
  [lux (#- Type type)
   [control
    [state (#+ State)]]
   [data
    [collection
     ["." list]]]
   [target
    [jvm
     ["." method (#+ Method)]
     ["_" instruction (#+ Label Instruction)]
     [constant
      [pool (#+ Pool)]]
     ["." type (#+ Type)
      ["." category]]]]]
  ["." //
   ["//#" /// #_
    ["#." value]
    [////
     [arity (#+ Arity)]]]])

(def: #export name "impl")

(def: #export (type arity)
  (-> Arity (Type category.Method))
  (type.method [(list.repeat arity ////value.type)
                ////value.type
                (list)]))

(def: #export (method' name arity @begin body)
  (-> Text Arity Label (Instruction Any) (State Pool Method))
  (method.method //.modifier name
                 (..type arity)
                 (list)
                 ($_ _.compose
                     (_.set-label @begin)
                     body
                     _.areturn
                     )))

(def: #export method
  (-> Arity Label (Instruction Any) (State Pool Method))
  (method' ..name))
