(.module:
  [lux (#- Type)
   [control
    [state (#+ State)]]
   [data
    [collection
     ["." list ("#@." functor)]
     ["." row]]]
   [target
    [jvm
     ["_" instruction (#+ Instruction)]
     ["." field (#+ Field)]
     [constant
      [pool (#+ Pool)]]
     [type (#+ Type)
      [category (#+ Value Class)]]]]]
  ["." //
   ["///#" //// #_
    ["#." reference]
    [////
     [reference (#+ Register)]
     [analysis (#+ Environment)]]]])

(def: #export (closure environment)
  (-> Environment (List (Type Value)))
  (list.repeat (list.size environment) //.type))

(def: #export (get class register)
  (-> (Type Class) Register (Instruction Any))
  (//.get class (/////reference.foreign-name register)))

(def: #export (put class register value)
  (-> (Type Class) Register (Instruction Any) (Instruction Any))
  (//.put /////reference.foreign-name class register value))

(def: #export variables
  (-> Environment (List (State Pool Field)))
  (|>> list.size (//.variables /////reference.foreign-name)))
