(.module:
  [lux (#- Definition)
   [data
    [binary (#+ Binary)]]
   [target
    [jvm
     ["_" instruction (#+ Label Instruction)]
     [encoding
      [name (#+ External)]]
     ["." type
      [category (#+ Value Return Method)]]]]]
  ["." ///
   [///
    [reference (#+ Register)]]]
  )

(type: #export Byte-Code Binary)

(type: #export Definition [Text Byte-Code])

(type: #export Anchor [Label Register])

(template [<name> <base>]
  [(type: #export <name>
     (<base> Anchor (Instruction Any) Definition))]

  [Operation ///.Operation]
  [Phase ///.Phase]
  [Handler ///.Handler]
  [Bundle ///.Bundle]
  )

(type: #export (Generator i)
  (-> Phase i (Operation (Instruction Any))))

(def: #export class (type.class "LuxRuntime" (list)))

(def: apply-failure-name
  "apply_fail")

(def: apply-failure-type
  (type.method [(list) type.void (list)]))

(def: #export apply-failure
  (Instruction Any)
  (_.invokestatic ..class ..apply-failure-name ..apply-failure-type))
