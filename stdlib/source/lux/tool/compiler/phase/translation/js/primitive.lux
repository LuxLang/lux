(.module:
  [lux (#- i64)
   [control
    [pipe (#+ cond> new>)]]
   [data
    [number
     ["." i64]
     ["." frac]]]
   [host
    ["_" js (#+ Expression)]]]
  [//
   ["//." runtime]])

(def: #export bit
  (-> Bit Expression)
  _.boolean)

(def: high
  (-> Int Int)
  (i64.logic-right-shift 32))

(def: low
  (-> Int Int)
  (let [mask (dec (i64.left-shift 32 1))]
    (|>> (i64.and mask))))

(def: #export (i64 value)
  (-> Int Expression)
  (//runtime.i64//new (|> value ..high _.i32)
                      (|> value ..low _.i32)))

(def: #export f64
  (-> Frac Expression)
  (|>> (cond> [(f/= frac.positive-infinity)]
              [(new> _.positive-infinity [])]
              
              [(f/= frac.negative-infinity)]
              [(new> _.negative-infinity [])]
              
              [(f/= frac.not-a-number)]
              [(new> _.not-a-number [])]
              
              ## else
              [_.number])))

(def: #export text
  (-> Text Expression)
  _.string)
