(.module:
  [lux #*
   [data
    ["." product]
    ["." text
     format
     ["." encoding]]
    [collection
     ["." row]
     ["." list ("#@." monad fold)]]]
   [host
    ["_" js]]
   [tool
    [compiler
     [phase
      [generation (#+ Output)]]]]
   [world
    [binary (#+ Binary)]]])

(def: #export (package outputs)
  (All [statements]
    (-> (Output statements) Binary))
  (|> outputs
      row.to-list
      (list@map (function (_ [module buffer])
                  (|> buffer
                      row.to-list
                      (:coerce (List [Name _.Statement]))
                      (list@map product.right))))
      list@join
      (list@fold (function (_ post! pre!)
                   (_.then pre! post!))
                 _.use-strict)
      (: _.Statement)
      _.code
      encoding.to-utf8))
