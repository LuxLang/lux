(.module:
  [library
   [lux #*
    [abstract
     [monad (#+ do)]]
    [control
     ["." io (#+ IO)]
     ["." try (#+ Try)]]
    [data
     [binary (#+ Binary)]
     [text
      ["%" format (#+ format)]]]
    [world
     ["." file (#+ File)]]]])

(def: extension ".class")

(def: #export (write_class! name bytecode)
  (-> Text Binary (IO Text))
  (let [file_path (format name ..extension)]
    (do io.monad
      [outcome (do (try.with @)
                 [file (: (IO (Try (File IO)))
                          (file.get_file io.monad file.default file_path))]
                 (\ file over_write bytecode))]
      (in (case outcome
            (#try.Success definition)
            file_path

            (#try.Failure error)
            error)))))
