... This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
... If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.

(.using
 [library
  [lux (.except its revised has)]])

(every .public (Lens context focus)
  (Record
   [#its (-> context focus)
    #has (-> [focus context] context)]))

(the .public (lens its has)
  (for_any (_ context focus)
    (-> (-> context focus) (-> [focus context] context)
        (Lens context focus)))
  [#its its
   #has has])

(the .public (its lens context)
  (for_any (_ context focus)
    (-> (Lens context focus) context
        focus))
  (by lens #its context))

(the .public (has lens value context)
  (for_any (_ context focus)
    (-> (Lens context focus) focus
        (Change context)))
  (by lens #has [value context]))

(the .public (revised lens change context)
  (for_any (_ context focus)
    (-> (Lens context focus) (Change focus)
        (Change context)))
  (has lens (change (its lens context)) context))

(the .public (composite outer inner)
  (for_any (_ outermost middle innermost)
    (-> (Lens outermost middle) (Lens middle innermost)
        (Lens outermost innermost)))
  [#its (|>> (its outer)
             (its inner))
   #has (function (_ [focus context])
          (revised outer (has inner focus) context))])
