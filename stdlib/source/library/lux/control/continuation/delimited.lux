... This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
... If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.

(.require
 [library
  [lux (.except)]]
 [// (.except)])

... Inspired by;
... "Delimited continuations in Haskell" by Oleg Kiselyov

(the .public reset
  (All (_ of)
    (-> (Cont of of)
        (Cont of)))
  (let [in (of ..monad in)]
    (|>> (..continued ..empty)
         in)))

(alias [context]
       ..reset)

(the .public (shift exit)
  (All (_ shift_return reset_return)
    (-> (-> (Context shift_return reset_return)
            (Cont reset_return reset_return))
        (Cont shift_return reset_return)))
  (function (_ after_shift)
    (|> (exit (function (_ value)
                (after_shift value)))
        (..continued ..empty))))

(alias [exit]
       ..shift)
