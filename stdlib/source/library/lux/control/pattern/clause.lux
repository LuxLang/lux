... This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
... If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.

(.require
 [library
  [lux (.except Pattern
                or)
   [meta
    ["[0]" type]]]]
 [//
  ["[0]" input]
  ["[0]" match]
  ["[0]" body (.only Body)]])

(every .public (Pattern input negative value)
  (Ex (_ arity)
    (type.let [positive (body.Then arity value)]
      [(-> match.Constant (-> negative positive))
       (-> input (Body input.Zero arity value))])))

(every .public (Clause input value)
  (-> input (body.Else value)
      value))

(the .public (clause pattern body)
  (All (_ input term value)
    (-> (Pattern input term value) term
        (Clause input value)))
  (function (_ input exit)
    (let [[number match] pattern]
      ((match input) (number match.constant body) exit []))))

(the .public (or left right)
  (All (_ input value)
    (-> (Clause input value) (Clause input value)
        (Clause input value)))
  (function (_ input exit)
    (left input
          (function (_ _)
            (right input exit)))))
