(;module:
  lux
  (lux (control [monad #+ do])
       (data [maybe]
             text/format
             (coll [dict])))
  (luxc ["&" base]
        (lang ["ls" synthesis])
        (generator (host ["$" jvm])))
  (. ["./;" common]
     ["./;" host]))

(def: procedures
  ./common;Bundle
  (|> ./common;procedures
      (dict;merge ./host;procedures)))

(def: #export (generate-procedure generate name args)
  (-> (-> ls;Synthesis (Meta $;Inst)) Text (List ls;Synthesis)
      (Meta $;Inst))
  (<| (maybe;default (&;fail (format "Unknown procedure: " (%t name))))
      (do maybe;Monad<Maybe>
        [proc (dict;get name procedures)]
        (wrap (proc generate args)))))
